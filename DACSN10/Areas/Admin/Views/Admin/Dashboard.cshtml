@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
    var stats = ViewBag.Stats ?? new
    {
        TotalUsers = 0,
        TotalTeachers = 0,
        TotalStudents = 0,
        TotalCourses = 0,
        ActiveCourses = 0,
        PendingCourses = 0,
        TotalEnrollments = 0,
        TotalRevenue = 0,
        PendingPayments = 0
    };
}

@section Breadcrumb {
    <li class="breadcrumb-item active">Dashboard</li>
}

<!-- Stats Cards Row -->
<div class="row mb-4" data-aos="fade-up">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="stats-icon" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                <i class="fas fa-users"></i>
            </div>
            <div class="stats-number text-primary" id="totalUsersCounter">@stats.TotalUsers</div>
            <div class="stats-label">Tổng người dùng</div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="stats-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                <i class="fas fa-chalkboard-teacher"></i>
            </div>
            <div class="stats-number text-success" id="totalTeachersCounter">@stats.TotalTeachers</div>
            <div class="stats-label">Giảng viên</div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="stats-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                <i class="fas fa-book-open"></i>
            </div>
            <div class="stats-number text-warning" id="totalCoursesCounter">@stats.TotalCourses</div>
            <div class="stats-label">Khóa học</div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="stats-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="stats-number text-info" id="totalRevenueCounter">@stats.TotalRevenue.ToString("N0")₫</div>
            <div class="stats-label">Doanh thu</div>
        </div>
    </div>
</div>

<!-- Charts and Quick Actions Row -->
<div class="row mb-4">
    <!-- Revenue Chart -->
    <div class="col-xl-8 col-lg-7 mb-4">
        <div class="admin-card" data-aos="fade-up" data-aos-delay="100">
            <div class="card-header-custom">
                <h5><i class="fas fa-chart-line me-2"></i>Doanh thu theo tháng</h5>
            </div>
            <div class="card-body">
                <canvas id="revenueChart" height="100"></canvas>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="col-xl-4 col-lg-5 mb-4">
        <div class="admin-card" data-aos="fade-up" data-aos-delay="200">
            <div class="card-header-custom">
                <h5><i class="fas fa-bolt me-2"></i>Thao tác nhanh</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-3">
                    <a href="/Admin/Admin/CreateCourse" class="btn btn-admin-primary">
                        <i class="fas fa-plus me-2"></i>Tạo khóa học mới
                    </a>
                    <a href="/Admin/Admin/CreateTeacher" class="btn btn-admin-success">
                        <i class="fas fa-user-plus me-2"></i>Thêm giảng viên
                    </a>
                    <a href="/Admin/Admin/Payments?status=Pending" class="btn btn-admin-warning">
                        <i class="fas fa-clock me-2"></i>Duyệt thanh toán (@stats.PendingPayments)
                    </a>
                    <a href="/Admin/Admin/Courses?status=Pending" class="btn btn-admin-info">
                        <i class="fas fa-eye me-2"></i>Duyệt khóa học (@stats.PendingCourses)
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Analytics Row -->
<div class="row mb-4">
    <!-- Course Stats -->
    <div class="col-xl-6 col-lg-6 mb-4">
        <div class="admin-card" data-aos="fade-up" data-aos-delay="300">
            <div class="card-header-custom">
                <h5><i class="fas fa-graduation-cap me-2"></i>Thống kê khóa học</h5>
            </div>
            <div class="card-body">
                <canvas id="courseStatsChart" height="120"></canvas>
            </div>
        </div>
    </div>

    <!-- User Distribution -->
    <div class="col-xl-6 col-lg-6 mb-4">
        <div class="admin-card" data-aos="fade-up" data-aos-delay="400">
            <div class="card-header-custom">
                <h5><i class="fas fa-users me-2"></i>Phân bổ người dùng</h5>
            </div>
            <div class="card-body">
                <canvas id="userDistributionChart" height="120"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activities and Pending Actions -->
<div class="row">
    <!-- Recent Activities -->
    <div class="col-xl-8 col-lg-7 mb-4">
        <div class="admin-card" data-aos="fade-up" data-aos-delay="500">
            <div class="card-header-custom">
                <h5><i class="fas fa-history me-2"></i>Hoạt động gần đây</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Thời gian</th>
                                <th>Hoạt động</th>
                                <th>Người dùng</th>
                                <th>Trạng thái</th>
                            </tr>
                        </thead>
                        <tbody id="recentActivitiesTable">
                            <tr>
                                <td>10:30 AM</td>
                                <td>Đăng ký khóa học "JavaScript cơ bản"</td>
                                <td>Nguyễn Văn A</td>
                                <td><span class="status-badge status-active">Hoàn thành</span></td>
                            </tr>
                            <tr>
                                <td>09:45 AM</td>
                                <td>Thanh toán khóa học "React Advanced"</td>
                                <td>Trần Thị B</td>
                                <td><span class="status-badge status-pending">Chờ duyệt</span></td>
                            </tr>
                            <tr>
                                <td>09:30 AM</td>
                                <td>Tạo khóa học mới "Python for AI"</td>
                                <td>GV. Lê Văn C</td>
                                <td><span class="status-badge status-pending">Chờ phê duyệt</span></td>
                            </tr>
                            <tr>
                                <td>08:15 AM</td>
                                <td>Đăng ký tài khoản giảng viên</td>
                                <td>Phạm Thị D</td>
                                <td><span class="status-badge status-active">Đã duyệt</span></td>
                            </tr>
                            <tr>
                                <td>07:30 AM</td>
                                <td>Hoàn thành khóa học "HTML & CSS"</td>
                                <td>Võ Văn E</td>
                                <td><span class="status-badge status-active">Hoàn thành</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- System Alerts and Notifications -->
    <div class="col-xl-4 col-lg-5 mb-4">
        <div class="admin-card" data-aos="fade-up" data-aos-delay="600">
            <div class="card-header-custom">
                <h5><i class="fas fa-bell me-2"></i>Cảnh báo hệ thống</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-warning" role="alert">
                    <h6 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Cần chú ý</h6>
                    <p class="mb-1">Có <strong>@stats.PendingPayments thanh toán</strong> đang chờ duyệt</p>
                    <hr>
                    <p class="mb-0">
                        <a href="/Admin/Admin/Payments?status=Pending" class="btn btn-warning btn-sm">
                            <i class="fas fa-eye me-1"></i>Xem ngay
                        </a>
                    </p>
                </div>

                <div class="alert alert-info" role="alert">
                    <h6 class="alert-heading"><i class="fas fa-info-circle me-2"></i>Thông tin</h6>
                    <p class="mb-1">Có <strong>@stats.PendingCourses khóa học</strong> chờ phê duyệt</p>
                    <hr>
                    <p class="mb-0">
                        <a href="/Admin/Admin/Courses?status=Pending" class="btn btn-info btn-sm">
                            <i class="fas fa-eye me-1"></i>Kiểm tra
                        </a>
                    </p>
                </div>

                <div class="alert alert-success" role="alert">
                    <h6 class="alert-heading"><i class="fas fa-check-circle me-2"></i>Hệ thống ổn định</h6>
                    <p class="mb-0">Tất cả dịch vụ hoạt động bình thường</p>
                </div>

                <!-- Quick Stats -->
                <div class="mt-4">
                    <h6 class="fw-bold mb-3">Thống kê nhanh hôm nay</h6>
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <div class="bg-light p-3 rounded">
                                <h4 class="text-primary mb-1">12</h4>
                                <small class="text-muted">Đăng ký mới</small>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="bg-light p-3 rounded">
                                <h4 class="text-success mb-1">8</h4>
                                <small class="text-muted">Thanh toán</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-light p-3 rounded">
                                <h4 class="text-warning mb-1">5</h4>
                                <small class="text-muted">Khóa học mới</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-light p-3 rounded">
                                <h4 class="text-info mb-1">23</h4>
                                <small class="text-muted">Bài học hoàn thành</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Initialize counters animation
            animateCounters();

            // Initialize charts
            initializeCharts();

            // Load real-time data
            loadRecentActivities();

            // Auto-refresh every 30 seconds
            setInterval(function() {
                loadRecentActivities();
                updateCounters();
            }, 30000);
        });

        function animateCounters() {
            $('.stats-number').each(function() {
                const $this = $(this);
                const target = parseInt($this.text().replace(/[^\d]/g, ''));
                const duration = 2000;
                const steps = 60;
                const increment = target / steps;
                let current = 0;

                const timer = setInterval(function() {
                    current += increment;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }

                    if ($this.attr('id') === 'totalRevenueCounter') {
                        $this.text(Math.floor(current).toLocaleString() + '₫');
                    } else {
                        $this.text(Math.floor(current));
                    }
                }, duration / steps);
            });
        }

        function initializeCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
                    datasets: [{
                        label: 'Doanh thu (triệu VNĐ)',
                        data: [12, 15, 18, 22, 25, 28, 32, 35, 38, 42, 45, 48],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Course Stats Chart
            const courseStatsCtx = document.getElementById('courseStatsChart').getContext('2d');
            new Chart(courseStatsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Hoạt động', 'Chờ duyệt', 'Tạm dừng'],
                    datasets: [{
                        data: [@stats.ActiveCourses, @stats.PendingCourses, 3],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // User Distribution Chart
            const userDistCtx = document.getElementById('userDistributionChart').getContext('2d');
            new Chart(userDistCtx, {
                type: 'bar',
                data: {
                    labels: ['Học viên', 'Giảng viên', 'Admin'],
                    datasets: [{
                        label: 'Số lượng',
                        data: [@stats.TotalStudents, @stats.TotalTeachers, 3],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(139, 92, 246, 0.8)'
                        ],
                        borderWidth: 0,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function loadRecentActivities() {
            // Simulate loading recent activities
            // In real implementation, this would be an AJAX call
            console.log('Loading recent activities...');
        }

        function updateCounters() {
            // Simulate updating counters
            // In real implementation, this would fetch fresh data via AJAX
            console.log('Updating counters...');
        }

        // Real-time notifications
        function checkForNotifications() {
            // Simulate checking for new notifications
            $.get('/Admin/GetNotifications', function(data) {
                if (data && data.length > 0) {
                    data.forEach(function(notification) {
                        toastr.info(notification.message);
                    });
                }
            }).fail(function() {
                console.log('Failed to load notifications');
            });
        }

        // Check for notifications every minute
        setInterval(checkForNotifications, 60000);
    </script>
}