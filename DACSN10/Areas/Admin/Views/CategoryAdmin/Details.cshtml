@model DACSN10.Areas.Admin.Models.CategoryAdminViewModel
@{
    ViewData["Title"] = "Chi tiết danh mục";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
    var courses = ViewBag.Courses as List<DACSN10.Models.Course> ?? new List<DACSN10.Models.Course>();
}

<div class="container-fluid px-4 animate__animated animate__fadeIn">
    <h1 class="mt-4">Chi tiết danh mục</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="/Admin">Trang chủ</a></li>
        <li class="breadcrumb-item"><a asp-action="Index">Danh mục</a></li>
        <li class="breadcrumb-item active">Chi tiết</li>
    </ol>

    <div class="row">
        <div class="col-xl-6">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-info-circle me-1"></i>
                    Thông tin danh mục
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-4">ID</dt>
                        <dd class="col-sm-8">@Model.CategoryID</dd>

                        <dt class="col-sm-4">Tên danh mục</dt>
                        <dd class="col-sm-8">@Model.Name</dd>

                        <dt class="col-sm-4">Mô tả</dt>
                        <dd class="col-sm-8">@(string.IsNullOrEmpty(Model.Description) ? "Không có mô tả" : Model.Description)</dd>

                        <dt class="col-sm-4">Số lượng khóa học</dt>
                        <dd class="col-sm-8">
                            <span class="badge bg-primary">@Model.CourseCount khóa học</span>
                        </dd>
                    </dl>

                    <div class="mt-3">
                        <a asp-action="Edit" asp-route-id="@Model.CategoryID" class="btn btn-primary">
                            <i class="fas fa-edit me-1"></i> Chỉnh sửa
                        </a>
                        <a asp-action="Index" class="btn btn-secondary ms-2">
                            <i class="fas fa-arrow-left me-1"></i> Trở về danh sách
                        </a>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-chart-pie me-1"></i>
                    Thống kê danh mục
                </div>
                <div class="card-body">
                    <canvas id="courseStatusChart" width="100%" height="40"></canvas>
                </div>
            </div>
        </div>

        <div class="col-xl-6">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-book-open me-1"></i>
                    Danh sách khóa học thuộc danh mục
                </div>
                <div class="card-body">
                    @if (courses.Any())
                    {
                        <div class="table-responsive">
                            <table id="courseTable" class="table table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Tên khóa học</th>
                                        <th>Giảng viên</th>
                                        <th>Trạng thái</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var course in courses)
                                    {
                                        <tr>
                                            <td>@course.CourseID</td>
                                            <td>@course.TenKhoaHoc</td>
                                            <td>@course.User.HoTen</td>
                                            <td>
                                                @if (course.TrangThai == "Published")
                                                {
                                                    <span class="badge bg-success">Đang hoạt động</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-danger">Không hoạt động</span>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i> Chưa có khóa học nào thuộc danh mục này.
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // DataTables
            $('#courseTable').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.10.25/i18n/Vietnamese.json'
                },
                responsive: true,
                pageLength: 5,
                lengthMenu: [[5, 10, 25, 50, -1], [5, 10, 25, 50, "Tất cả"]]
            });

            // Dữ liệu cho biểu đồ
            var ctx = document.getElementById("courseStatusChart");

            // Đếm số lượng khóa học hoạt động và không hoạt động
            const activeCount = @courses.Where(c => c.TrangThai == "Published").Count();
            const inactiveCount = @courses.Where(c => c.TrangThai == "Draft").Count();

            var myPieChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ["Đang hoạt động", "Không hoạt động"],
                    datasets: [{
                        data: [activeCount, inactiveCount],
                        backgroundColor: ['#1cc88a', '#e74a3b'],
                        hoverBackgroundColor: ['#17a673', '#e02d1b'],
                        hoverBorderColor: "rgba(234, 236, 244, 1)",
                    }],
                },
                options: {
                    maintainAspectRatio: false,
                    tooltips: {
                        backgroundColor: "rgb(255,255,255)",
                        bodyFontColor: "#858796",
                        borderColor: '#dddfeb',
                        borderWidth: 1,
                        xPadding: 15,
                        yPadding: 15,
                        displayColors: false,
                        caretPadding: 10,
                    },
                    legend: {
                        display: true,
                        position: 'bottom'
                    },
                    cutoutPercentage: 70,
                },
            });

            // Hiệu ứng Animate.css khi trang tải
            $(".card").addClass("animate__animated animate__fadeIn");
        });
    </script>
}