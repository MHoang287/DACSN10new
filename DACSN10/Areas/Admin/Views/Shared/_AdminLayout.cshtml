<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Admin Panel | OnlineLearning</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <!-- Bootswatch Theme -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/lux/bootstrap.min.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <!-- AOS -->
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css" />
    <!-- Toastr -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" />
    <!-- Select2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />

    <link rel="stylesheet" href="~/css/admin-site.css"  />

    @RenderSection("Styles", required: false)
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner-grow text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Sidebar -->
    <nav class="admin-sidebar" id="adminSidebar">
        <div class="admin-logo">
            <h3><i class="fas fa-graduation-cap"></i> Admin</h3>
        </div>
        <div class="admin-menu">
            <a href="@Url.Action("Dashboard", "Admin")" class="admin-menu-item @(ViewContext.RouteData.Values["action"]?.ToString() == "Dashboard" ? "active" : "")">
                <i class="fas fa-tachometer-alt"></i>
                <span class="admin-menu-text">Dashboard</span>
            </a>
            <a href="@Url.Action("Courses", "Admin")" class="admin-menu-item @(ViewContext.RouteData.Values["action"]?.ToString() == "Courses" ? "active" : "")">
                <i class="fas fa-book"></i>
                <span class="admin-menu-text">Khóa học</span>
            </a>
            <a href="@Url.Action("Categories", "Admin")" class="admin-menu-item @(ViewContext.RouteData.Values["action"]?.ToString() == "Categories" ? "active" : "")">
                <i class="fas fa-tags"></i>
                <span class="admin-menu-text">Danh mục</span>
            </a>
            <a href="@Url.Action("Students", "Admin")" class="admin-menu-item @(ViewContext.RouteData.Values["action"]?.ToString() == "Students" ? "active" : "")">
                <i class="fas fa-user-graduate"></i>
                <span class="admin-menu-text">Học viên</span>
            </a>
            <a href="@Url.Action("Teachers", "Admin")" class="admin-menu-item @(ViewContext.RouteData.Values["action"]?.ToString() == "Teachers" ? "active" : "")">
                <i class="fas fa-chalkboard-teacher"></i>
                <span class="admin-menu-text">Giảng viên</span>
            </a>
            <a href="@Url.Action("Payments", "Admin")" class="admin-menu-item @(ViewContext.RouteData.Values["action"]?.ToString() == "Payments" ? "active" : "")">
                <i class="fas fa-credit-card"></i>
                <span class="admin-menu-text">Thanh toán</span>
            </a>
            <a href="@Url.Action("Statistics", "Admin")" class="admin-menu-item @(ViewContext.RouteData.Values["action"]?.ToString() == "Statistics" ? "active" : "")">
                <i class="fas fa-chart-line"></i>
                <span class="admin-menu-text">Thống kê</span>
            </a>
            <a href="@Url.Action("RevenueReport", "Admin")" class="admin-menu-item @(ViewContext.RouteData.Values["action"]?.ToString() == "RevenueReport" ? "active" : "")">
                <i class="fas fa-file-invoice-dollar"></i>
                <span class="admin-menu-text">Báo cáo doanh thu</span>
            </a>
            <a href="@Url.Action("Analytics", "Admin")" class="admin-menu-item @(ViewContext.RouteData.Values["action"]?.ToString() == "Analytics" ? "active" : "")">
                <i class="fas fa-analytics"></i>
                <span class="admin-menu-text">Phân tích</span>
            </a>
            <a href="@Url.Action("SystemHealth", "Admin")" class="admin-menu-item @(ViewContext.RouteData.Values["action"]?.ToString() == "SystemHealth" ? "active" : "")">
                <i class="fas fa-heartbeat"></i>
                <span class="admin-menu-text">Hệ thống</span>
            </a>
            <a href="@Url.Action("Settings", "Admin")" class="admin-menu-item @(ViewContext.RouteData.Values["action"]?.ToString() == "Settings" ? "active" : "")">
                <i class="fas fa-cog"></i>
                <span class="admin-menu-text">Cài đặt</span>
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="admin-main" id="adminMain">
        <!-- Top Bar -->
        <div class="admin-topbar">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>

            <div class="admin-user-menu">
                <div class="dropdown">
                    <button class="btn btn-link text-decoration-none dropdown-toggle d-flex align-items-center gap-2"
                            data-bs-toggle="dropdown">
                        <div class="admin-user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <span class="d-none d-md-inline">@User.Identity.Name</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                            <a class="dropdown-item" href="@Url.Action("Index", "Home")">
                                <i class="fas fa-home me-2"></i>Trang chủ
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <form class="d-inline" asp-area="Identity" asp-page="/Account/Logout"
                                  asp-route-returnUrl="@Url.Action("Index", "Home")">
                                <button type="submit" class="dropdown-item">
                                    <i class="fas fa-sign-out-alt me-2"></i>Đăng xuất
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="admin-content">
            @RenderBody()
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Initialize AOS
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true
        });

        // Sidebar Toggle
        $('#sidebarToggle').click(function() {
            $('#adminSidebar').toggleClass('collapsed');
            $('#adminMain').toggleClass('expanded');

            // Save state to localStorage
            localStorage.setItem('sidebarCollapsed', $('#adminSidebar').hasClass('collapsed'));
        });

        // Restore sidebar state
        if (localStorage.getItem('sidebarCollapsed') === 'true') {
            $('#adminSidebar').addClass('collapsed');
            $('#adminMain').addClass('expanded');
        }

        // Mobile sidebar
        if (window.innerWidth < 768) {
            $('#sidebarToggle').click(function() {
                $('#adminSidebar').toggleClass('show');
            });
        }

        // Toastr Configuration
        toastr.options = {
            "closeButton": true,
            "progressBar": true,
            "positionClass": "toast-top-right",
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };

        // Show toastr messages from TempData
        @if (TempData["Success"] != null)
        {
            <text>toastr.success('@TempData["Success"]');</text>
        }
        @if (TempData["Error"] != null)
        {
            <text>toastr.error('@TempData["Error"]');</text>
        }
        @if (TempData["Warning"] != null)
        {
            <text>toastr.warning('@TempData["Warning"]');</text>
        }
        @if (TempData["Info"] != null)
        {
            <text>toastr.info('@TempData["Info"]');</text>
        }

        // Loading functions
        function showLoading() {
            $('#loadingOverlay').addClass('show');
        }

        function hideLoading() {
            $('#loadingOverlay').removeClass('show');
        }

        // AJAX loading
        $(document).ajaxStart(function() {
            showLoading();
        }).ajaxStop(function() {
            hideLoading();
        });

        // Confirm delete function
        function confirmDelete(url, message = 'Bạn có chắc chắn muốn xóa?') {
            Swal.fire({
                title: 'Xác nhận xóa',
                text: message,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Xóa',
                cancelButtonText: 'Hủy'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.post(url, { __RequestVerificationToken: $('[name="__RequestVerificationToken"]').val() })
                        .done(function(response) {
                            if (response.success) {
                                toastr.success(response.message);
                                setTimeout(() => location.reload(), 1500);
                            } else {
                                toastr.error(response.message);
                            }
                        })
                        .fail(function() {
                            toastr.error('Có lỗi xảy ra!');
                        });
                }
            });
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(amount);
        }

        // Format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('vi-VN');
        }
    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>