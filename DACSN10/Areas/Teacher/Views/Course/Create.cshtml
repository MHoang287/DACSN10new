@model DACSN10.Areas.Teacher.Models.CourseViewModel

@{
    ViewData["Title"] = "Create Course";
    Layout = "~/Areas/Teacher/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid px-4 animate__animated animate__fadeIn">
    <h1 class="mt-4 mb-4">
        <i class="fas fa-plus-circle"></i> Create New Course
    </h1>

    <div class="row">
        <div class="col-xl-8">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-book me-1"></i>
                    Course Details
                </div>
                <div class="card-body">
                    <form asp-action="Create" enctype="multipart/form-data" id="createCourseForm">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                        <div class="mb-3">
                            <label asp-for="TenKhoaHoc" class="form-label">Course Name</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-heading"></i></span>
                                <input asp-for="TenKhoaHoc" class="form-control" placeholder="Enter course name" data-intro="Enter the name of your course here" required />
                            </div>
                            <span asp-validation-for="TenKhoaHoc" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="MoTa" class="form-label">Description</label>
                            <textarea asp-for="MoTa" class="form-control" rows="4" placeholder="Enter course description" data-intro="Provide a detailed description of your course"></textarea>
                            <span asp-validation-for="MoTa" class="text-danger"></span>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label asp-for="Gia" class="form-label">Price (VND)</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-money-bill"></i></span>
                                    <input asp-for="Gia" class="form-control" type="number" min="0" placeholder="0" />
                                </div>
                                <span asp-validation-for="Gia" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="TrangThai" class="form-label">Status</label>
                                <select asp-for="TrangThai" class="form-select">
                                    <option value="Draft">Draft</option>
                                    <option value="Published">Published</option>
                                </select>
                                <span asp-validation-for="TrangThai" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Categories</label>
                            <div class="card">
                                <div class="card-body py-2 px-3">
                                    @foreach (var category in Model.AvailableCategories)
                                    {
                                        <div class="form-check form-check-inline">
                                            <input type="checkbox"
                                                   name="SelectedCategories"
                                                   value="@category.CategoryID"
                                                   class="form-check-input"
                                                   id="category-@category.CategoryID" />
                                            <label class="form-check-label" for="category-@category.CategoryID">@category.Name</label>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 text-end">
                            <a asp-action="Index" class="btn btn-outline-secondary me-2">
                                <i class="fas fa-arrow-left"></i> Back to List
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Create Course
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-xl-4">
            <div class="card mb-4 border-info">
                <div class="card-header bg-info text-white">
                    <i class="fas fa-info-circle me-1"></i>
                    Tips for Creating Great Courses
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li class="mb-3">
                            <i class="fas fa-check-circle text-success"></i>
                            <strong>Clear Title:</strong> Choose a concise and descriptive title
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check-circle text-success"></i>
                            <strong>Detailed Description:</strong> Include what students will learn
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check-circle text-success"></i>
                            <strong>Fair Pricing:</strong> Set a competitive price for your content
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check-circle text-success"></i>
                            <strong>Proper Categorization:</strong> Choose relevant categories for better discovery
                        </li>
                    </ul>
                    <hr>
                    <p class="mb-0">
                        <i class="fas fa-lightbulb text-warning"></i>
                        <em>Tip: You can save as draft to complete your course later before publishing.</em>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(document).ready(function() {
            // Rich text editor for description
            $("#MoTa").kendoEditor({
                tools: [
                    "bold", "italic", "underline", "strikethrough",
                    "justifyLeft", "justifyCenter", "justifyRight", "justifyFull",
                    "insertUnorderedList", "insertOrderedList", "indent", "outdent",
                    "createLink", "unlink", "insertImage", "subscript", "superscript",
                    "tableWizard", "createTable", "addRowAbove", "addRowBelow", "addColumnLeft",
                    "addColumnRight", "deleteRow", "deleteColumn", "viewHtml", "formatting",
                    "cleanFormatting"
                ],
                resizable: {
                    content: true,
                    toolbar: true
                }
            });

            // Form validation
            $("#createCourseForm").validate({
                rules: {
                    TenKhoaHoc: {
                        required: true,
                        minlength: 5
                    },
                    Gia: {
                        required: true,
                        min: 0
                    }
                },
                messages: {
                    TenKhoaHoc: {
                        required: "Please enter a course name",
                        minlength: "Course name must be at least 5 characters long"
                    },
                    Gia: {
                        required: "Please enter a price",
                        min: "Price cannot be negative"
                    }
                },
                errorElement: "div",
                errorClass: "invalid-feedback",
                highlight: function(element) {
                    $(element).addClass("is-invalid").removeClass("is-valid");
                },
                unhighlight: function(element) {
                    $(element).addClass("is-valid").removeClass("is-invalid");
                },
                errorPlacement: function(error, element) {
                    error.insertAfter(element.closest(".input-group"));
                }
            });

            // Initialize intro.js
            $("#startTour").on("click", function() {
                introJs().start();
            });

            // Submit form handling with SweetAlert
            $("#createCourseForm").on("submit", function(e) {
                if (!$(this).valid()) {
                    toastr.error("Please fix the validation errors before submitting");
                    return true; // Let the validation handle the errors
                }
            });
        });
    </script>
}