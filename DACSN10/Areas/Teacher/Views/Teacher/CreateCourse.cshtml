@model DACSN10.Models.Course
@{
    ViewData["Title"] = "Tạo khóa học mới";
    Layout = "~/Areas/Teacher/Views/Shared/_TeacherLayout.cshtml";
}

@section Styles {
    <link href="~/css/teacher-createcourse.css" rel="stylesheet" />
}

<!-- Page Header -->
<div class="page-header" data-aos="fade-down">
    <h1 class="page-title">Tạo khóa học mới</h1>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="@Url.Action("Dashboard", "Teacher")">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="@Url.Action("MyCourses", "Teacher")">Khóa học</a></li>
            <li class="breadcrumb-item active">Tạo mới</li>
        </ol>
    </nav>
</div>

<div class="create-course-container">
    <form asp-action="CreateCourse" method="post" id="createCourseForm">
        <!-- Basic Information -->
        <div class="form-card" data-aos="fade-up">
            <h3 class="section-title">
                <i class="fas fa-info-circle"></i>
                Thông tin cơ bản
            </h3>

            <div class="info-box">
                <i class="fas fa-lightbulb"></i>
                <p>Khóa học của bạn sẽ được admin xem xét trước khi xuất bản. Hãy cung cấp thông tin chi tiết và chính xác.</p>
            </div>

            <div class="form-section">
                <div class="mb-4">
                    <label asp-for="TenKhoaHoc" class="form-label">
                        Tên khóa học <span class="required">*</span>
                    </label>
                    <input asp-for="TenKhoaHoc" class="form-control" placeholder="VD: Lập trình Web với ASP.NET Core" maxlength="200" />
                    <div class="char-counter">
                        <span id="titleCharCount">0</span>/200
                    </div>
                    <span asp-validation-for="TenKhoaHoc" class="validation-error"></span>
                </div>

                <div class="mb-4">
                    <label asp-for="MoTa" class="form-label">
                        Mô tả khóa học <span class="required">*</span>
                    </label>
                    <textarea asp-for="MoTa" class="form-control"
                              placeholder="Mô tả chi tiết về khóa học, nội dung sẽ học, đối tượng phù hợp..."
                              maxlength="1000"></textarea>
                    <div class="char-counter">
                        <span id="descCharCount">0</span>/1000
                    </div>
                    <span asp-validation-for="MoTa" class="validation-error"></span>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-4">
                        <label asp-for="Gia" class="form-label">
                            Giá khóa học <span class="required">*</span>
                        </label>
                        <div class="price-input-group">
                            <input asp-for="Gia" type="number" class="form-control" placeholder="0" min="0" step="1000" />
                            <span class="currency-symbol">VNĐ</span>
                        </div>
                        <small class="text-muted">Để 0 nếu muốn khóa học miễn phí</small>
                        <span asp-validation-for="Gia" class="validation-error"></span>
                    </div>

                    <div class="col-md-6 mb-4">
                        <label asp-for="TrangThai" class="form-label">
                            Trạng thái <span class="required">*</span>
                        </label>
                        <select asp-for="TrangThai" class="form-select" disabled>
                            <option value="Pending" selected>Chờ duyệt</option>
                        </select>
                        <small class="text-muted">Khóa học mới sẽ ở trạng thái chờ duyệt</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Categories -->
        <div class="form-card" data-aos="fade-up" data-aos-delay="100">
            <h3 class="section-title">
                <i class="fas fa-tags"></i>
                Danh mục khóa học
            </h3>

            <p class="text-muted mb-3">Chọn các danh mục phù hợp với nội dung khóa học (tối đa 3 danh mục)</p>

            <div class="categories-container">
                @if (ViewBag.Categories != null)
                {
                    @foreach (var category in ViewBag.Categories as SelectList)
                    {
                        <div class="category-item">
                            <input type="checkbox"
                                   id="category_@category.Value"
                                   name="selectedCategories"
                                   value="@category.Value" />
                            <label for="category_@category.Value">@category.Text</label>
                        </div>
                    }
                }
            </div>
        </div>

        <!-- Preview -->
        <div class="form-card" data-aos="fade-up" data-aos-delay="200">
            <h3 class="section-title">
                <i class="fas fa-eye"></i>
                Xem trước
            </h3>

            <div class="preview-section">
                <div class="preview-title">Tên khóa học</div>
                <div class="preview-content" id="previewTitle">
                    <span class="text-muted">Chưa nhập tên khóa học</span>
                </div>
            </div>

            <div class="preview-section">
                <div class="preview-title">Mô tả</div>
                <div class="preview-content" id="previewDescription">
                    <span class="text-muted">Chưa nhập mô tả</span>
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
            <a href="@Url.Action("MyCourses", "Teacher")" class="btn-cancel">
                <i class="fas fa-times"></i>
                Hủy bỏ
            </a>
            <button type="submit" class="btn-submit">
                <i class="fas fa-save"></i>
                Tạo khóa học
            </button>
        </div>
    </form>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Đang tạo khóa học...</p>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        $(document).ready(function() {
            // Character counters
            $('#TenKhoaHoc').on('input', function() {
                const length = $(this).val().length;
                $('#titleCharCount').text(length);
                $('#previewTitle').html($(this).val() || '<span class="text-muted">Chưa nhập tên khóa học</span>');
            });

            $('#MoTa').on('input', function() {
                const length = $(this).val().length;
                $('#descCharCount').text(length);
                $('#previewDescription').html($(this).val().replace(/\n/g, '<br>') || '<span class="text-muted">Chưa nhập mô tả</span>');
            });

            // Category selection limit
            $('input[name="selectedCategories"]').on('change', function() {
                const checkedCount = $('input[name="selectedCategories"]:checked').length;
                if (checkedCount > 3) {
                    $(this).prop('checked', false);
                    toastr.warning('Chỉ được chọn tối đa 3 danh mục');
                }
            });

            // Form submission
            $('#createCourseForm').on('submit', function(e) {
                e.preventDefault();

                // Validate
                if (!$('#TenKhoaHoc').val().trim()) {
                    toastr.error('Vui lòng nhập tên khóa học');
                    $('#TenKhoaHoc').focus();
                    return;
                }

                if (!$('#MoTa').val().trim()) {
                    toastr.error('Vui lòng nhập mô tả khóa học');
                    $('#MoTa').focus();
                    return;
                }

                // Show loading
                $('#loadingOverlay').css('display', 'flex');

                // Submit form
                this.submit();
            });

            // Initialize tooltips
            $('[data-bs-toggle="tooltip"]').tooltip();
        });
    </script>
}