@model DACSN10.Models.Payment
@{
    ViewData["Title"] = $"Chi tiết giao dịch #{Model.PaymentID.ToString("D6")} - OnlineLearning";
}

@section Styles {
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="~/css/PaymentDetails.css" rel="stylesheet" />
}

<div class="details-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="details-card" data-aos="fade-up">
                    <div class="details-header">
                        <h2 class="mb-0">
                            <i class="fas fa-receipt me-3"></i>
                            Chi tiết giao dịch
                        </h2>
                        <p class="mb-0 mt-2">Mã giao dịch: #@Model.PaymentID.ToString("D6")</p>
                    </div>

                    <div class="p-4">
                        <!-- Thông tin cơ bản -->
                        <div class="invoice-section" data-aos="fade-up" data-aos-delay="100">
                            <h5 class="mb-3">
                                <i class="fas fa-info-circle me-2"></i>Thông tin giao dịch
                            </h5>

                            <div class="info-row">
                                <span class="info-label">Mã giao dịch:</span>
                                <span class="info-value fw-bold">#@Model.PaymentID.ToString("D6")</span>
                            </div>

                            <div class="info-row">
                                <span class="info-label">Trạng thái:</span>
                                <span class="info-value">
                                    @switch (Model.Status)
                                    {
                                        case PaymentStatus.Success:
                                            <span class="badge bg-success">
                                                <i class="fas fa-check-circle me-1"></i>Thành công
                                            </span>
                                            break;
                                        case PaymentStatus.Pending:
                                            <span class="badge bg-warning">
                                                <i class="fas fa-clock me-1"></i>Chờ xử lý
                                            </span>
                                            break;
                                        case PaymentStatus.Failed:
                                            <span class="badge bg-danger">
                                                <i class="fas fa-times-circle me-1"></i>Thất bại
                                            </span>
                                            break;
                                    }
                                </span>
                            </div>

                            <div class="info-row">
                                <span class="info-label">Ngày tạo:</span>
                                <span class="info-value">@Model.NgayThanhToan.ToString("dd/MM/yyyy HH:mm:ss")</span>
                            </div>

                            <div class="info-row">
                                <span class="info-label">Phương thức:</span>
                                <span class="info-value">
                                    <img src="https://developers.momo.vn/v3/assets/images/square-logo.svg"
                                         width="20" height="20" class="me-2" alt="MoMo">
                                    @Model.PhuongThucThanhToan
                                </span>
                            </div>

                            <div class="info-row">
                                <span class="info-label">Số tiền:</span>
                                <span class="info-value amount-highlight">@Model.SoTien.ToString("N0")₫</span>
                            </div>
                        </div>

                        <!-- Thông tin khóa học -->
                        <div class="invoice-section" data-aos="fade-up" data-aos-delay="200">
                            <h5 class="mb-3">
                                <i class="fas fa-book me-2"></i>Thông tin khóa học
                            </h5>

                            <div class="row">
                                <div class="col-md-8">
                                    <div class="info-row">
                                        <span class="info-label">Tên khóa học:</span>
                                        <span class="info-value fw-bold">@Model.Course.TenKhoaHoc</span>
                                    </div>

                                    <div class="info-row">
                                        <span class="info-label">Mô tả:</span>
                                        <span class="info-value">@(Model.Course.MoTa ?? "Chưa có mô tả")</span>
                                    </div>

                                    <div class="info-row">
                                        <span class="info-label">Giá gốc:</span>
                                        <span class="info-value text-success fw-bold">@Model.Course.Gia.ToString("N0")₫</span>
                                    </div>
                                </div>
                                <div class="col-md-4 text-end">
                                    <div class="bg-primary text-white rounded p-3 text-center">
                                        <i class="fas fa-graduation-cap fa-2x mb-2"></i>
                                        <div class="small">Khóa học</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Thông tin người mua -->
                        <div class="invoice-section" data-aos="fade-up" data-aos-delay="300">
                            <h5 class="mb-3">
                                <i class="fas fa-user me-2"></i>Thông tin người mua
                            </h5>

                            <div class="info-row">
                                <span class="info-label">Họ tên:</span>
                                <span class="info-value">@Model.User.HoTen</span>
                            </div>

                            <div class="info-row">
                                <span class="info-label">Email:</span>
                                <span class="info-value">@Model.User.Email</span>
                            </div>

                            <div class="info-row">
                                <span class="info-label">Số điện thoại:</span>
                                <span class="info-value">@(Model.User.PhoneNumber ?? "Chưa cập nhật")</span>
                            </div>
                        </div>

                        <!-- Trạng thái chi tiết -->
                        @if (Model.Status == PaymentStatus.Pending)
                        {
                            <div class="alert alert-warning" data-aos="fade-up" data-aos-delay="400">
                                <h6 class="alert-heading">
                                    <i class="fas fa-clock me-2"></i>Giao dịch đang chờ xử lý
                                </h6>
                                <p class="mb-0">
                                    Giao dịch của bạn đang được admin xem xét và xử lý.
                                    Thời gian xử lý thường trong vòng 24 giờ làm việc.
                                    Bạn sẽ nhận được email thông báo khi giao dịch được duyệt.
                                </p>
                            </div>
                        }
                        else if (Model.Status == PaymentStatus.Success)
                        {
                            <div class="alert alert-success" data-aos="fade-up" data-aos-delay="400">
                                <h6 class="alert-heading">
                                    <i class="fas fa-check-circle me-2"></i>Giao dịch thành công
                                </h6>
                                <p class="mb-0">
                                    Thanh toán đã được xác nhận thành công.
                                    Khóa học đã được kích hoạt cho tài khoản của bạn.
                                    Bạn có thể bắt đầu học ngay bây giờ.
                                </p>
                            </div>
                        }
                        else if (Model.Status == PaymentStatus.Failed)
                        {
                            <div class="alert alert-danger" data-aos="fade-up" data-aos-delay="400">
                                <h6 class="alert-heading">
                                    <i class="fas fa-times-circle me-2"></i>Giao dịch thất bại
                                </h6>
                                <p class="mb-0">
                                    Giao dịch không thể hoàn thành.
                                    Vui lòng thử lại hoặc liên hệ bộ phận hỗ trợ để được trợ giúp.
                                </p>
                            </div>
                        }

                        <!-- Action buttons -->
                        <div class="row mt-4" data-aos="fade-up" data-aos-delay="500">
                            <div class="col-md-4 mb-3">
                                <a asp-action="History" class="btn btn-outline-secondary w-100 py-3">
                                    <i class="fas fa-arrow-left me-2"></i>Quay lại
                                </a>
                            </div>
                            <div class="col-md-4 mb-3">
                                @if (Model.Status == PaymentStatus.Success)
                                {
                                    <a asp-controller="Course" asp-action="Details" asp-route-id="@Model.CourseID"
                                       class="btn btn-primary w-100 py-3">
                                        <i class="fas fa-play me-2"></i>Vào học
                                    </a>
                                }
                                else if (Model.Status == PaymentStatus.Failed)
                                {
                                    <a asp-action="Create" asp-route-courseId="@Model.CourseID"
                                       class="btn btn-warning w-100 py-3">
                                        <i class="fas fa-redo me-2"></i>Thanh toán lại
                                    </a>
                                }
                                else
                                {
                                    <button class="btn btn-outline-danger w-100 py-3" onclick="cancelPayment(@Model.PaymentID)">
                                        <i class="fas fa-times me-2"></i>Hủy giao dịch
                                    </button>
                                }
                            </div>
                            <div class="col-md-4 mb-3">
                                <button class="btn btn-info w-100 py-3" onclick="printInvoice()">
                                    <i class="fas fa-print me-2"></i>In hóa đơn
                                </button>
                            </div>
                        </div>

                        <!-- Additional Info -->
                        <div class="text-center mt-4 pt-4 border-top" data-aos="fade-up" data-aos-delay="600">
                            <small class="text-muted">
                                <i class="fas fa-shield-alt me-2"></i>
                                Giao dịch được bảo mật bởi OnlineLearning Platform
                            </small>
                            <br>
                            <small class="text-muted">
                                Liên hệ hỗ trợ: support@onlinelearning.vn | 1900 1234
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="~/js/PaymentDetails.js"></script>

    @Html.AntiForgeryToken()
}