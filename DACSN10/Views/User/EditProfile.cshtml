@model DACSN10.Models.User
@{
    ViewData["Title"] = "Chỉnh sửa hồ sơ - OnlineLearning";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css" />
    <link rel="stylesheet" href="~/css/EditProfile.css" />
}

<div class="profile-section">
    <div class="container-fluid px-4 px-md-5">
        <!-- Profile Header -->
        <div class="profile-header" data-aos="fade-up">
            <div class="text-center">
                <h1 class="mb-3">
                    <i class="fas fa-user-edit me-3"></i>
                    Chỉnh sửa hồ sơ cá nhân
                </h1>
                <p class="mb-0 opacity-90">Cập nhật thông tin để có trải nghiệm tốt hơn</p>
            </div>
        </div>

        <!-- Profile Form -->
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="profile-card" data-aos="fade-up" data-aos-delay="200">

                    <!-- Progress Indicator -->
                    <div class="progress-indicator">
                        <div class="progress-step active">1</div>
                        <div class="progress-step">2</div>
                        <div class="progress-step">3</div>
                    </div>

                    <!-- Info Card -->
                    <div class="info-card">
                        <div class="d-flex align-items-start">
                            <div class="info-card-icon">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div>
                                <h5 class="mb-2">Thông tin cá nhân</h5>
                                <p class="mb-0 text-muted">
                                    Cập nhật thông tin cá nhân để chúng tôi có thể phục vụ bạn tốt hơn.
                                    Tất cả thông tin của bạn được bảo mật tuyệt đối.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Avatar Section -->
                    <div class="avatar-section" data-aos="fade-up" data-aos-delay="300">
                        <img src="https://ui-avatars.com/api/?name=@Uri.EscapeDataString(Model.HoTen ?? "User")&background=3b82f6&color=fff&bold=true&size=120"
                             alt="Avatar" class="avatar-large" id="avatarPreview">
                        <div>
                            <button type="button" class="avatar-upload-btn" onclick="$('#avatarInput').click()">
                                <i class="fas fa-camera"></i>
                                Thay đổi avatar
                            </button>
                            <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="previewAvatar(event)">
                        </div>
                    </div>

                    <!-- Validation Summary -->
                    @if (!ViewData.ModelState.IsValid)
                    {
                        <div class="validation-summary" data-aos="fade-up" data-aos-delay="400">
                            <h6 class="text-danger mb-3">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Vui lòng kiểm tra các lỗi sau:
                            </h6>
                            <div asp-validation-summary="All" class="text-danger"></div>
                        </div>
                    }

                    <!-- Profile Form -->
                    <form asp-action="EditProfile" method="post" id="profileForm" data-aos="fade-up" data-aos-delay="500">
                        @Html.AntiForgeryToken()

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-user text-primary"></i>
                                        Họ và tên
                                    </label>
                                    <div class="input-group-custom">
                                        <i class="fas fa-user input-icon"></i>
                                        <input asp-for="HoTen" class="form-control-custom form-control-with-icon"
                                               placeholder="Nhập họ và tên của bạn" required>
                                    </div>
                                    <span asp-validation-for="HoTen" class="field-validation-error"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-envelope text-primary"></i>
                                        Email
                                    </label>
                                    <div class="input-group-custom">
                                        <i class="fas fa-envelope input-icon"></i>
                                        <input asp-for="Email" class="form-control-custom form-control-with-icon"
                                               placeholder="Nhập địa chỉ email" type="email" required>
                                    </div>
                                    <span asp-validation-for="Email" class="field-validation-error"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-phone text-primary"></i>
                                        Số điện thoại
                                    </label>
                                    <div class="input-group-custom">
                                        <i class="fas fa-phone input-icon"></i>
                                        <input asp-for="PhoneNumber" class="form-control-custom form-control-with-icon"
                                               placeholder="Nhập số điện thoại" type="tel">
                                    </div>
                                    <span asp-validation-for="PhoneNumber" class="field-validation-error"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-calendar text-primary"></i>
                                        Ngày đăng ký
                                    </label>
                                    <div class="input-group-custom">
                                        <i class="fas fa-calendar input-icon"></i>
                                        <input value="@Model.NgayDangKy.ToString("dd/MM/yyyy")"
                                               class="form-control-custom form-control-with-icon"
                                               readonly disabled>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-user-tag text-primary"></i>
                                        Loại tài khoản
                                    </label>
                                    <div class="input-group-custom">
                                        <i class="fas fa-user-tag input-icon"></i>
                                        <input value="@Model.LoaiNguoiDung"
                                               class="form-control-custom form-control-with-icon"
                                               readonly disabled>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-toggle-on text-primary"></i>
                                        Trạng thái
                                    </label>
                                    <div class="input-group-custom">
                                        <i class="fas fa-toggle-on input-icon"></i>
                                        <input value="@Model.TrangThai"
                                               class="form-control-custom form-control-with-icon"
                                               readonly disabled>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden fields -->
                        <input asp-for="Id" type="hidden">
                        <input asp-for="UserName" type="hidden">
                        <input asp-for="NormalizedUserName" type="hidden">
                        <input asp-for="NormalizedEmail" type="hidden">
                        <input asp-for="EmailConfirmed" type="hidden">
                        <input asp-for="PasswordHash" type="hidden">
                        <input asp-for="SecurityStamp" type="hidden">
                        <input asp-for="ConcurrencyStamp" type="hidden">
                        <input asp-for="PhoneNumberConfirmed" type="hidden">
                        <input asp-for="TwoFactorEnabled" type="hidden">
                        <input asp-for="LockoutEnd" type="hidden">
                        <input asp-for="LockoutEnabled" type="hidden">
                        <input asp-for="AccessFailedCount" type="hidden">
                        <input asp-for="NgayDangKy" type="hidden">
                        <input asp-for="TrangThai" type="hidden">
                        <input asp-for="LoaiNguoiDung" type="hidden">

                        <!-- Form Actions -->
                        <div class="d-flex gap-3 justify-content-center mt-4">
                            <button type="submit" class="btn-primary-custom" id="saveBtn">
                                <i class="fas fa-save"></i>
                                <span>Lưu thay đổi</span>
                                <div class="spinner-border spinner-border-sm ms-2" style="display: none;" id="saveSpinner"></div>
                            </button>
                            <a href="@Url.Action("Dashboard")" class="btn-secondary-custom">
                                <i class="fas fa-arrow-left"></i>
                                Quay lại
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Security Section -->
        <div class="row justify-content-center mt-4">
            <div class="col-lg-8">
                <div class="security-section" data-aos="fade-up" data-aos-delay="600">
                    <div class="text-center">
                        <div class="security-icon mx-auto">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h4 class="mb-3">Bảo mật tài khoản</h4>
                        <p class="text-muted mb-4">
                            Để tăng cường bảo mật, hãy thay đổi mật khẩu định kỳ và kích hoạt xác thực hai yếu tố.
                        </p>
                        <div class="d-flex gap-3 justify-content-center flex-wrap">
                            <a href="/Identity/Account/Manage/ChangePassword" class="btn btn-warning rounded-pill px-4">
                                <i class="fas fa-key me-2"></i>
                                Đổi mật khẩu
                            </a>
                            <a href="/Identity/Account/Manage/TwoFactorAuthentication" class="btn btn-success rounded-pill px-4">
                                <i class="fas fa-mobile-alt me-2"></i>
                                Xác thực 2FA
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Hidden data for JavaScript -->
<script type="text/javascript">
    window.EditProfileData = {
        hasSuccess: @(TempData["Success"] != null ? "true" : "false"),
        hasError: @(TempData["Error"] != null ? "true" : "false"),
        successMessage: '@(TempData["Success"]?.ToString() ?? "")',
        errorMessage: '@(TempData["Error"]?.ToString() ?? "")'
    };
</script>

@section Scripts {
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="~/js/EditProfile.js"></script>
    @Html.AntiForgeryToken()
}