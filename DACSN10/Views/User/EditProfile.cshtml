@model DACSN10.Models.User
@{
    ViewData["Title"] = "Cập nhật thông tin cá nhân";
}

<head>
    <link rel="stylesheet" href="~/css/profile.css" />
</head>

<div class="container profile-container">
    <div class="row">
        <!-- Sidebar Profile -->
        <div class="col-lg-3 mb-4">
            <div class="card profile-sidebar">
                <div class="card-body text-center">
                    <div class="profile-avatar mb-3">
                        <img src="/api/placeholder/150/150" class="rounded-circle img-fluid" alt="Profile Picture" />
                    </div>
                    <h5 class="mb-1">@Model.HoTen</h5>
                    <p class="text-muted small mb-3">@Model.Email</p>
                    <div class="profile-info mb-3">
                        <div class="badge bg-primary w-100 p-2 mb-2">@Model.LoaiNguoiDung</div>
                        <div class="badge bg-info w-100 p-2">Đã tham gia @Model.NgayDangKy.ToString("dd/MM/yyyy")</div>
                    </div>
                </div>
                <div class="list-group list-group-flush">
                    <a href="@Url.Action("EditProfile", "User")" class="list-group-item list-group-item-action active">
                        <i class="fas fa-user-edit me-2"></i> Thông tin cá nhân
                    </a>
                    <a href="@Url.Action("MyCourses", "Course")" class="list-group-item list-group-item-action">
                        <i class="fas fa-book me-2"></i> Khóa học của tôi
                    </a>
                    <a href="@Url.Action("Progress", "Course")" class="list-group-item list-group-item-action">
                        <i class="fas fa-chart-line me-2"></i> Tiến độ học tập
                    </a>
                    <a href="@Url.Action("FavoriteCourses", "Course")" class="list-group-item list-group-item-action">
                        <i class="fas fa-heart me-2"></i> Khóa học yêu thích
                    </a>
                    <a href="@Url.Action("History", "Payment")" class="list-group-item list-group-item-action">
                        <i class="fas fa-history me-2"></i> Lịch sử thanh toán
                    </a>

                    @if (Model.LoaiNguoiDung == "teacher")
                    {
                        <a href="@Url.Action("TeacherProfile", "User", new { id = Model.Id })" class="list-group-item list-group-item-action">
                            <i class="fas fa-chalkboard-teacher me-2"></i> Trang giảng viên
                        </a>
                    }
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-lg-9">
            <div class="card">
                <div class="card-header bg-white">
                    <h4 class="mb-0"><i class="fas fa-user-edit me-2"></i>Thông tin cá nhân</h4>
                </div>
                <div class="card-body">
                    @if (TempData["Success"] != null)
                    {
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="fas fa-check-circle me-2"></i> @TempData["Success"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }

                    <form method="post" action="@Url.Action("EditProfile", "User")">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="HoTen" class="form-label">Họ và tên</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                                    <input type="text" class="form-control" id="HoTen" name="HoTen" value="@Model.HoTen" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="UserName" class="form-label">Tên đăng nhập</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                                    <input type="text" class="form-control" id="UserName" value="@Model.UserName" disabled>
                                </div>
                                <small class="text-muted">Tên đăng nhập không thể thay đổi</small>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="Email" class="form-label">Email</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                    <input type="email" class="form-control" id="Email" name="Email" value="@Model.Email" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="PhoneNumber" class="form-label">Số điện thoại</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                    <input type="tel" class="form-control" id="PhoneNumber" name="PhoneNumber" value="@Model.PhoneNumber">
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Loại tài khoản</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-user-shield"></i></span>
                                    <input type="text" class="form-control" value="@Model.LoaiNguoiDung" disabled>
                                </div>
                                <small class="text-muted">Loại tài khoản do quản trị viên quản lý</small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ngày đăng ký</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                                    <input type="text" class="form-control" value="@Model.NgayDangKy.ToString("dd/MM/yyyy")" disabled>
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> Lưu thay đổi
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Change Password Card -->
            <div class="card mt-4">
                <div class="card-header bg-white">
                    <h4 class="mb-0"><i class="fas fa-key me-2"></i>Thay đổi mật khẩu</h4>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-4">Để thay đổi mật khẩu, vui lòng sử dụng trang đổi mật khẩu chính thức.</p>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="/Identity/Account/Manage/ChangePassword" class="btn btn-outline-primary">
                            <i class="fas fa-key me-1"></i> Đổi mật khẩu
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Hiển thị thông báo thành công sử dụng SweetAlert2
        @if (TempData["Success"] != null)
        {
            <text>
                    Swal.fire({
                        title: 'Thành công!',
                        text: '@TempData["Success"]',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
            </text>
        }

            // Xác nhận trước khi gửi form
            $('form').submit(function(e) {
                e.preventDefault();

                Swal.fire({
                    title: 'Xác nhận thay đổi',
                    text: 'Bạn có chắc chắn muốn cập nhật thông tin cá nhân?',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Cập nhật',
                    cancelButtonText: 'Hủy'
                }).then((result) => {
                    if (result.isConfirmed) {
                        this.submit();
                    }
                });
            });
        });
    </script>

    <style>
        .profile-container {
            max-width: 1100px;
        }

        .profile-sidebar {
            border-radius: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
        }

        .profile-avatar img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border: 4px solid #f8f9fa;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .card {
            border-radius: 1rem;
            border: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card-header {
            border-radius: 1rem 1rem 0 0 !important;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .list-group-item {
            border-left: none;
            border-right: none;
            padding: 0.75rem 1.25rem;
            transition: all 0.2s;
        }

            .list-group-item:first-child {
                border-top: none;
            }

            .list-group-item:last-child {
                border-bottom: none;
                border-radius: 0 0 1rem 1rem;
            }

            .list-group-item:hover {
                background-color: #f8f9fa;
            }

            .list-group-item.active {
                background-color: #0d6efd;
                border-color: #0d6efd;
            }

        .input-group-text {
            background-color: #f8f9fa;
        }

        

    </style>
}